<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.vnua.mapper.LoginMapper">

    <select id="findByUsernameAndPassword" resultType="com.vnua.model.SysUser">
        SELECT user_id,
               login_name AS loginname,
               password,
               user_name AS username,
               del_flag,user_type as userType
        FROM sys_user
        WHERE login_name = #{loginname}
          AND password = #{password};
    </select>

    <update id="updateLoginDate">
        UPDATE sys_user SET login_date = getdate()
        where user_id = #{id}
    </update>

    <select id="logFullName" resultType="com.vnua.model.SysUser">
        SELECT user_name AS username
        FROM sys_user
        WHERE login_name = #{loginname}
    </select>

    <select id="showProfile" resultType="com.vnua.model.SysUser">
        SELECT user_name as username , email,role,user_id FROM sys_user
        WHERE user_type != 00 and del_flag = 0
        <if test="name != null and name != ''">
            AND user_name LIKE CONCAT('%', #{name}, '%')
        </if>
        <if test="dept != null and dept != ''">
            AND email LIKE CONCAT('%', #{dept}, '%')
        </if>
        <if test="role != null and role != ''">
            AND role LIKE CONCAT('%', #{role}, '%')
        </if>
        ORDER BY  RIGHT(user_name, CHARINDEX(' ', REVERSE(user_name)) - 1),user_name
    </select>

</mapper>
