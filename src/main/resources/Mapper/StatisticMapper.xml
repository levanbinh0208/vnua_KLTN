<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.vnua.mapper.StatisticMapper">
    <resultMap id="PublicationResultMap" type="com.vnua.model.Publication">
        <id property="pubId" column="pub_id"/>
        <result property="userId" column="user_id"/>
        <result property="title" column="title"/>
        <result property="authors" column="authors"/>
        <result property="journal" column="journal"/>
        <result property="year" column="year"/>
        <result property="abstractText" column="abstract"/>
        <result property="url" column="url"/>
        <result property="wordFileName" column="word_File_Name"/>
        <result property="createdAt" column="created_at"/>
    </resultMap>

    <select id="countUsers" resultType="int">
        SELECT COUNT(*) FROM sys_user
        WHERE del_flag = 0 AND user_type != 99
    </select>

    <select id="countPublications" resultType="int">
        SELECT COUNT(*) FROM publication
    </select>

    <select id="countPendingPublications" resultType="int">
        SELECT COUNT(*) FROM publication
        WHERE status = 0
    </select>

    <select id="getPublicationsByDept" resultType="map">
        SELECT
        u.email AS dept,
        COUNT(*) AS cnt
        FROM publication p
        JOIN sys_user u ON p.user_id = u.user_id
        GROUP BY u.email
    </select>

    <select id="getPublicationsByYear" resultType="map">
        SELECT
            CAST(p.year AS VARCHAR) AS year,
            COUNT(*) AS cnt
        FROM publication p
        GROUP BY p.year
        ORDER BY p.year DESC
    </select>
</mapper>